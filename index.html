// FIND this section in your index.html file (around line 650-680):
// In the LoginFormHandler class, replace the existing "if (response.success)" block with this:

if (response.success) {
    this.showMessage('âœ¨ Access Granted. Welcome to the mystery...', 'success');
    
    // FIXED: Store authentication in both sessionStorage AND HTTP cookies
    sessionStorage.setItem('dutchPortalAuth', 'authenticated');
    sessionStorage.setItem('dutchPortalUser', username);
    sessionStorage.setItem('dutchPortalTime', Date.now().toString());
    
    // NEW: Set HTTP cookies that will be sent to the server
    const cookieOptions = `path=/; max-age=${24*60*60}; secure; samesite=strict`;
    document.cookie = `dutchPortalAuth=authenticated; ${cookieOptions}`;
    document.cookie = `dutchPortalUser=${encodeURIComponent(username)}; ${cookieOptions}`;
    
    // Store session token if provided
    if (response.sessionToken) {
        sessionStorage.setItem('dutchPortalSession', response.sessionToken);
        document.cookie = `dutchPortalSession=${response.sessionToken}; ${cookieOptions}`;
    }
    
    // Trigger success effects
    if (window.DutchMysteryPortal) {
        window.DutchMysteryPortal.triggerSuccessEffects();
    }
    
    // NEW: Redirect to ADE guide after showing success message
    setTimeout(() => {
        this.showMessage('Preparing your journey into the Dutch void...', 'info');
        setTimeout(() => {
            window.location.href = '/ade-2025-guide';
        }, 1500);
    }, 2000);
    
} else {
    this.showMessage('ðŸ”’ Access Denied. The mystery remains sealed...', 'error');
}

// ALSO ADD this new logout function at the end of your HTML script section:
// (Replace the existing logout function if there is one)

function logout() {
    // Clear sessionStorage
    sessionStorage.removeItem('dutchPortalAuth');
    sessionStorage.removeItem('dutchPortalUser');
    sessionStorage.removeItem('dutchPortalTime');
    sessionStorage.removeItem('dutchPortalSession');
    
    // NEW: Clear HTTP cookies
    document.cookie = 'dutchPortalAuth=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    document.cookie = 'dutchPortalUser=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    document.cookie = 'dutchPortalSession=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    
    // Show logout confirmation
    if (window.DutchMysteryPortal) {
        window.DutchMysteryPortal.showMessage('Logged out successfully. The portal awaits your return...', 'info');
    }
    
    // Redirect to home after short delay
    setTimeout(() => {
        window.location.href = '/';
    }, 1500);
}
